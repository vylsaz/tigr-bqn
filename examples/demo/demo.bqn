tigr â† â€¢Import "../../tigr.bqn"

tk â† tigr.key
tfont â† tigr.tfont

standing â† 1
remaining â† 0

pl â† 160â€¿200
pls â† 0â€¿0

backdrop â† @
screen â† @

Update â† {ğ•Š dt:
    {remaining>0? remaining -â†© dt; @}

    pls +â†© ({
        âˆ¨Â´screen.KeyHeldÂ¨tk.leftâ€¿'A'? Â¯10; 0
    }+{
        âˆ¨Â´screen.KeyHeldÂ¨tk.rightâ€¿'D'? 10; 0
    })â€¿{
        standingâˆ§screen.KeyDown tk.space? Â¯200; 0
    }
    
    old â† pl

    pls Ã—â†© â‹†dtÃ—Â¯10â€¿Â¯2
    pls +â†© dtÃ—0â€¿200
    pl +â†© dtÃ—pls
 
    {(âŠ‘pl)<8? 
        pl â†© 8â€¿0+0â€¿1Ã—pl
        pls Ã—â†© 0â€¿1
    ;@}
    {(âŠ‘pl)>xâ†(screen.W@)-8? 
        pl â†© xâ€¿0+0â€¿1Ã—pl
        pls Ã—â†© 0â€¿1
    ;@}

    d â† (pl-old)Ã·10
    standing â†© 0
    {ğ•Š:
        p0 â† backdrop.Get âŒŠold-0â€¿1
        old -â†© âŸ¨0, âˆ§Â´0=3â†‘p0âŸ©
        p1 â† backdrop.Get âŒŠold
        {(0<1âŠ‘pls)âˆ§âˆ§Â´0=3â†‘p1?
            pls Ã—â†© 1â€¿0
            d Ã—â†© 1â€¿0
            standing â†© 1
        ;@}
        old +â†© d
    }âŸ10 @

    pl â†© old
}

squinkle â† tigr.LoadImage â€¢file.At "squinkle.png"
greeting â† â€¢FChars "greeting.txt"

screen â†© greeting tigr.flag.scale2x tigr._WindowWithFlag 320â€¿240
backdrop â†© tigr.Bitmap screen.Size@

backdrop.Clear 80â€¿180â€¿255
60â€¿120â€¿60 backdrop.Fill 0â€¿200â€¿320â€¿40
0â€¿0â€¿0 backdrop.Fill 0â€¿200â€¿320â€¿3
255â€¿255â€¿255 backdrop.Line 0â€¿201â€¿320â€¿201

screen.SetPostFX 1â€¿1â€¿1â€¿2

prev â† 0
prevXY â† 0â€¿0

chars â† 16â¥Š'_'

{ğ•Š:
    Update tigr.Time@
    
    xâ€¿yâ€¿b â† screen.Mouse@
    {1=2|b?
        {prev? 0â€¿0â€¿0 backdrop.Line prevXYâˆ¾âŸ¨x,yâŸ©; @}
        prevXY â†© xâ€¿y
        prev â†© 1
    ;
        prev â†© 0
    }

    0â€¿0 screen tigr._Blit_ backdrop 0â€¿0
    (âŒŠpl-0.5â€¿1Ã—squinkle.Size@) screen tigr._BlitAlpha_âŸ¨squinkle, 1âŸ© 0â€¿0

    192â€¿208â€¿255â€¿192 screen tfont._Print_ greeting 10â€¿10
    255â€¿255â€¿255 screen tfont._Print_"A D + SPACE" 10â€¿222

    {
        s â† ""
        c â† screen.ReadChar@
        {ğ•Š:
            s âˆ¾â†© c
            c â†© screen.ReadChar@
        }â€¢_while_{ğ•Š: câ‰ @} @
        chars â†© Â¯16â†‘charsâˆ¾s
    }
    255â€¿255â€¿255 screen tfont._Print_("Chars: "âˆ¾chars)160â€¿222

    screen.Update@
}â€¢_while_((Â¬ screen.Closed)âˆ§(Â¬ screen.KeyDownâŸœtk.escape)) @

tigr.Free screen
tigr.Free backdrop
tigr.Free squinkle

